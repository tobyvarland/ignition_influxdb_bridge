# Ignition-InfluxDB Bridge

Ignition-InfluxDB Bridge is a Python script designed to be run/managed by [Telegraf](https://www.influxdata.com/time-series-platform/telegraf/) using the [`execd`](https://github.com/influxdata/telegraf/blob/master/plugins/inputs/execd/README.md) plugin. The script connects to a PostgreSQL database populated by [Ignition Tag Historian](https://inductiveautomation.com/ignition/modules/tag-historian), reads data, and outputs lines of [InfluxDB Line Protocol](https://docs.influxdata.com/influxdb/v2/reference/syntax/line-protocol/) that are consumed by Telegraf and forwarded to [InfluxDB](https://www.influxdata.com/products/influxdb/) instances configured as output destinations within Telegraf.

Ignition-InfluxDB Bridge retrieves integer/float data from PostgreSQL using the Ignition timestamp. All data is stored in InfluxDB in a float field called `value` using the Ignition tag path as a tag.

The script itself is fairly simple. Because it interacts directly with the PostgreSQL database populated by Ignition Tag Historian, it does not need to know anything about or have any access to Ignition itself. The script only reads data from the PostgreSQL database, but you should configure a user with read only access for security anyway. Similarly, because the script is designed to be run/managed by Telegraf, the script does not need to know anything about the destination InfluxDB server(s). Telegraf makes it trivial to ingest lines of Line Protocol and forward the data to one or more InfluxDB servers.

I run most of this software on Apple Silicon Mac mini computers (PostgreSQL, Telegraf, InfluxDB, Redis, etc.). I don't know of a platform that makes configuration, management, and backups easier than macOS. You can theoretically run this script on any platform where you can run Telegraf, `execd`, and Python, but I have not tested any platform other than macOS and I don't intend to.

I store my environment variables in a `.env` file (sample provided). You theoretically don't have to do it that way, but it's what was easiest for me. All connection parameters for PostgreSQL and Redis are stored in environment variables, as is the name of the bucket where data should be stored in InfluxDB.

I am aware that there is a [commercial module made by Kymera Systems](https://www.kymerasystems.com/kymera-influxdb-module) that allows Ignition to write directly to InfluxDB and query data from InfluxDB in Ignition. I have no experience with that module but I assume it does exactly what it claims. There are benefits to that module (commercial support, not needing PostgreSQL at all, and being able to query InfluxDB data within Ignition, to name a few), but the module has a $5,000 price tag and I do not care about being able to query the historical data stored in InfluxDB from within Ignition. If those things matter to you, check out the Kymera's module.

I specifically wanted to get my data into InfluxDB for long term storage because it's easy to replicate data across multiple InfluxDB instances, it's easy to downsample older historical data in InfluxDB, it's easy for advanced end users to explore the data within InfluxDB, and [Grafana](https://grafana.com/) is my visualization platform of choice for historical data. I keep 90 days worth of historical data in the PostgreSQL database managed by Ignition, so I have that much data available within Ignition if necessary.